<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mani-Calc</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: transparent;
      -webkit-app-region: drag;
      overflow: hidden;
    }

    :root {
      --bg-color: rgba(255, 255, 255, 0.95);
      --text-color: #333;
      --icon-color: #00D9FF;
      --hint-color: #999;
      --shortcut-bg: rgba(0, 0, 0, 0.02);
      --key-bg: rgba(0, 0, 0, 0.1);
      --border-color: rgba(0, 0, 0, 0.1);
    }

    body.dark {
      --bg-color: rgba(30, 30, 30, 0.95);
      --text-color: #eee;
      --icon-color: #00D9FF;
      --hint-color: #666;
      --shortcut-bg: rgba(255, 255, 255, 0.05);
      --key-bg: rgba(255, 255, 255, 0.1);
      --border-color: rgba(255, 255, 255, 0.1);
    }

    .container {
      width: 600px;
      padding: 10px;
    }

    .search-box {
      background: var(--bg-color);
      backdrop-filter: blur(20px);
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      -webkit-app-region: no-drag;
      transition: background 0.3s ease;
    }

    .input-container {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .icon {
      font-size: 24px;
      margin-right: 12px;
      color: var(--icon-color);
      -webkit-app-region: drag;
      cursor: grab;
    }

    .icon:active {
      cursor: grabbing;
    }

    #search-input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 18px;
      background: transparent;
      color: var(--text-color);
    }

    #search-input::placeholder {
      color: var(--hint-color);
    }

    .result-container {
      padding: 12px 20px;
      background: rgba(0, 217, 255, 0.05);
      display: none;
      animation: slideDown 0.2s ease;
    }

    .result-container.show {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-text {
      font-size: 16px;
      color: var(--icon-color);
      font-weight: 600;
    }

    .result-text.error {
      color: #ff4444;
    }

    .result-text.success {
      color: var(--icon-color);
    }

    .result-text.system {
      color: #ff9800;
    }

    .hint {
      font-size: 12px;
      color: var(--hint-color);
      margin-top: 4px;
    }

    .shortcuts {
      padding: 8px 20px;
      background: var(--shortcut-bg);
      display: none;
      font-size: 11px;
      color: var(--hint-color);
    }

    .shortcuts.show {
      display: block;
    }

    .shortcut-item {
      display: inline-block;
      margin-right: 12px;
    }

    .key {
      background: var(--key-bg);
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="search-box">
      <div class="input-container">
        <div class="icon">⚡</div>
        <input type="text" id="search-input" placeholder="Type calculation or command..." autocomplete="off"
          spellcheck="false">
      </div>

      <div class="result-container" id="result-container">
        <div class="result-text" id="result-text"></div>
        <div class="hint" id="result-hint"></div>
      </div>

      <div class="shortcuts" id="shortcuts">
        <span class="shortcut-item"><span class="key">Enter</span> Execute</span>
        <span class="shortcut-item"><span class="key">Esc</span> Close</span>
        <span class="shortcut-item"><span class="key">Alt+Space</span> Toggle</span>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    const input = document.getElementById('search-input');
    const resultContainer = document.getElementById('result-container');
    const resultText = document.getElementById('result-text');
    const resultHint = document.getElementById('result-hint');
    const shortcuts = document.getElementById('shortcuts');

    let debounceTimer;

    // Focus input when window is shown
    ipcRenderer.on('focus-input', () => {
      input.focus();
      input.select();
      shortcuts.classList.add('show');
    });

    // Clear input when window is hidden
    ipcRenderer.on('clear-input', () => {
      input.value = '';
      resultContainer.classList.remove('show');
      shortcuts.classList.remove('show');
    });

    // Handle input
    input.addEventListener('input', (e) => {
      const query = e.target.value.trim();

      if (!query) {
        resultContainer.classList.remove('show');
        return;
      }

      // Debounce for live preview
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        processQuery(query, true);
      }, 300);
    });

    // Handle Enter key
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const query = input.value.trim();
        if (query) {
          processQuery(query, false);
        }
      } else if (e.key === 'Escape') {
        ipcRenderer.send('hide-window');
      }
    });

    // Process query
    function processQuery(query, isPreview) {
      if (!isPreview) {
        ipcRenderer.send('process-query', query);
      } else {
        // Show preview for calculations
        try {
          // Simple preview for math expressions
          if (/^[\d\s\+\-\*\/\(\)\.\^]+$/.test(query)) {
            showResult('Calculating...', 'Press Enter to execute', 'success');
          }
        } catch (error) {
          // Ignore preview errors
        }
      }
    }

    // Handle theme toggle
    ipcRenderer.on('toggle-theme', () => {
      document.body.classList.toggle('dark');
    });

    // Handle result from main process
    ipcRenderer.on('query-result', (event, result) => {
      if (result.error) {
        showResult(`✗ ${result.error}`, '', 'error');
      } else if (result.type === 'system_command') {
        showResult(`✓ ${result.formatted}`, 'Copied to clipboard', 'system');
      } else {
        showResult(`✓ ${result.formatted}`, 'Copied to clipboard', 'success');
      }
    });

    // Show result
    function showResult(text, hint, type) {
      resultText.textContent = text;
      resultText.className = `result-text ${type}`;
      resultHint.textContent = hint;
      resultContainer.classList.add('show');
    }

    // Auto-focus on load
    setTimeout(() => {
      input.focus();
    }, 100);
  </script>
</body>

</html>